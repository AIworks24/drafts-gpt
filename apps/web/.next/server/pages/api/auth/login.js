"use strict";(()=>{var e={};e.id=908,e.ids=[908],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},709:e=>{e.exports=import("@azure/msal-node")},6113:e=>{e.exports=require("crypto")},6835:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},9395:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{config:()=>u,default:()=>l,routeModule:()=>p});var o=r(9150),i=r(1631),a=r(6835),s=r(9647),c=e([s]);s=(c.then?(await c)():c)[0];let l=(0,a.l)(s,"default"),u=(0,a.l)(s,"config"),p=new o.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/auth/login",pathname:"/api/auth/login",bundlePath:"",filename:""},userland:s});n()}catch(e){n(e)}})},1277:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{LL:()=>c,Oh:()=>a,rW:()=>l});var o=r(709),i=e([o]);o=(i.then?(await i)():i)[0];let s=`https://login.microsoftonline.com/${process.env.AZURE_TENANT_ID}`,c=new o.ConfidentialClientApplication({auth:{clientId:process.env.AZURE_CLIENT_ID,clientSecret:process.env.AZURE_CLIENT_SECRET,authority:s},system:{loggerOptions:{logLevel:2}}}),l=["openid","profile","offline_access","https://graph.microsoft.com/Mail.Read","https://graph.microsoft.com/Mail.ReadWrite","https://graph.microsoft.com/Calendars.Read"];function a(e){let t={scopes:l,redirectUri:process.env.AZURE_REDIRECT_URI,state:e,prompt:"select_account"};return c.getAuthCodeUrl(t)}n()}catch(e){n(e)}})},4087:(e,t,r)=>{r.d(t,{Ov:()=>u,Gg:()=>l,py:()=>p,KY:()=>c});var n=r(6113);let o=require("cookie"),i="dgpt_sess",a=process.env.SESSION_SECRET;if(!a||a.length<32)throw Error("SESSION_SECRET too short");function s(e){return(0,n.createHash)("sha256").update(a+e).digest("hex")}function c(e,t){let r=JSON.stringify(t),n=s(r);e.setHeader("Set-Cookie",(0,o.serialize)(i,Buffer.from(r).toString("base64")+"."+n,{httpOnly:!0,sameSite:"lax",path:"/",secure:!0,maxAge:2592e3}))}function l(e){let t=(0,o.parse)(e.headers.cookie||"")[i];if(!t)return null;let[r,n]=t.split("."),a=Buffer.from(r||"","base64").toString();return s(a)!==n?null:JSON.parse(a)}function u(e){e.setHeader("Set-Cookie",(0,o.serialize)(i,"",{path:"/",maxAge:0}))}function p(){return(0,n.randomBytes)(16).toString("hex")}},9647:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{default:()=>s});var o=r(1277),i=r(4087),a=e([o]);async function s(e,t){let r=(0,i.py)(),n=await (0,o.Oh)(r);t.redirect(n)}o=(a.then?(await a)():a)[0],n()}catch(e){n(e)}})},1631:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},9150:(e,t,r)=>{e.exports=r(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=9395);module.exports=r})();